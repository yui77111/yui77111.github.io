---
title: CVE-2020-0618
description: sql server远程命令执行.
categories:
 - cve
tags: 
 - 渗透测试
---

## 一、漏洞概述

获得低权限的攻击者向受影响版本的SQL Server的Reporting Services实例发送精心构造的请求，可利用此漏洞在报表服务器服务帐户的上下文中执行任意代码。

## 二、受影响版本

SQL Server 2012 for 32-bit Systems Service Pack 4 (QFE)
SQL Server 2012 for x64-based Systems Service Pack 4 (QFE)
SQL Server 2014 Service Pack 3 for 32-bit Systems (CU)
SQL Server 2014 Service Pack 3 for 32-bit Systems (GDR)
SQL Server 2014 Service Pack 3 for x64-based Systems (CU)
SQL Server 2014 Service Pack 3 for x64-based Systems (GDR)
SQL Server 2016 for x64-based Systems Service Pack 1
SQL Server 2016 for x64-based Systems Service Pack 2 (CU)
SQL Server 2016 for x64-based Systems Service Pack 2 (GDR)

## 三、漏洞成因

在ReportingServicesWebServer.dll中发现了此问题.Microsoft.Reporting.WebForms.BrowserNavigationCorrector的OnLoad方法使用LosFormatter类反序列化不受信任的用户输入:

![1_1](https://yui77111.github.io/assets/images/article/cve/1_1.png)

该BrowserNavigationCorrector类是使用由Microsoft.ReportingServices.WebServer.ReportViewerPage类:

![1_2](https://yui77111.github.io/assets/images/article/cve/1_2.png)

所以可以通过在本地 SharePoint服务器中调用/ReportServer/pages/ReportViewer.aspx页面来触发此功能.

## 四、利用工具

[https://github.com/euphrat1ca/CVE-2020-0618](https://github.com/euphrat1ca/CVE-2020-0618)

## 五、漏洞复现

>靶机
>系统：windows server 2016 standard evaluation
>Sql版本：Microsoft SQL Server 2016 (RTM) - 13.0.1601.5 (X64)
>Ip：192.168.0.105
>攻击机
>系统：windows7
>Ip:192.168.0.103

(1) 存在漏洞路径。

![1_3](https://yui77111.github.io/assets/images/article/cve/1_3.png)

(2) 使用ysoserial.exe生成payload，生成完的payload存于剪切板。

![1_4](https://yui77111.github.io/assets/images/article/cve/1_4.png)

(3)	攻击机nc监听，利用poc加载payload反弹shell。接收到的权限为server权限。

![1_5](https://yui77111.github.io/assets/images/article/cve/1_5.png)

## 六、防护建议

由于攻击者可通过对请求数据包编码绕过Web应用防火墙的防护，强烈建议用户安装补丁程序进行修复。禁止匿名访问，确保只有经过身份验证的用户才能访问相关应用；如果怀疑服务器已经受到威胁，除安装相应补丁外，请及时更改服务器的账户口令，防止被攻击者利用。
版本对应补丁参阅
[https://portal.msrc.microsoft.com/zh-cn/security-guidance/advisory/CVE-2020-0618](https://portal.msrc.microsoft.com/zh-cn/security-guidance/advisory/CVE-2020-0618)

## 参考链接

[https://blog.csdn.net/qq_40989258/article/details/105344344](https://blog.csdn.net/qq_40989258/article/details/105344344)